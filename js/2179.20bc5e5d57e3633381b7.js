(self.webpackChunkremediations=self.webpackChunkremediations||[]).push([[2179],{79790:(e,t,a)=>{"use strict";a.d(t,{Q:()=>o});var s=a(33366),n=a(10756);const{API_BASE:i}=a(93940),o=e=>{const t=(0,s.Vk)(),[a,o]=(0,n.useState)(),l=(0,n.useRef)(!1);return(0,n.useEffect)((()=>(l.current=!0,(async()=>{try{const e=await t.get(`${i}/remediations/?fields[data]=name`);l.current&&o(e.data)}catch(e){console.error(e)}})(),()=>{l.current=!1})),[e]),a}},76910:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>He});var s=a(10756),n=a.n(s),i=a(45697),o=a.n(i),l=a(33366);const r=new(a(68004).HostsApi)(void 0,"/api/inventory/v1",l.ZP);function c(e,{page:t,perPage:a}){return r.apiHostGetHostById(e,void 0,a,t)}var m=a(37468),d=a(33626),u=a(68718),p=a.n(u);const y=async e=>{try{const t=await d.mY(e.map((e=>e.id))),[a,s]=p()(t,(([e,t],a,s)=>(a?e.push(a):t.push(`Issue ${s} does not have Ansible support`),[e,t])),[[],[]]);return{resolutions:a,warnings:s}}catch(e){return{errors:["Error obtaining resolution information. Please try again later."]}}};var h=a(28216),g=a(57283),E=a.n(g),f=a(18546);const b={isLoading:!1,hosts:[]},v={[`${m.mg}_FULFILLED`]:(e,{payload:t})=>({...e,hosts:[...e.hosts,...t.results||[]],isLoading:!1}),[`${m.mg}_PENDING`]:e=>({...e,isLoading:!0})};var k=a(39133),S=a(24350),w=a.n(S),T=a(51912),R=a(67850),C=a(96354),x=a(64124),I=a(10621);const F=e=>[{name:I.mT,component:"select-playbook",validate:[{type:x.Z.PATTERN,pattern:/^$|^.*[\w\d]+.*$/},{type:x.Z.REQUIRED},(t,a)=>{if(!a[I.yu]&&t)return((e,t)=>(()=>{const a=e.trim(),s={};return t&&t.forEach((e=>{s[e.name]=!0})),!!s[a]})())(t,e)?"A playbook with the same name already exists within your organization. Try a different name.":void 0}]},{name:I.yu,component:C.Z.TEXT_FIELD,hideField:!0},{name:I.m0,component:C.Z.TEXT_FIELD,hideField:!0},{name:I.Vf,component:C.Z.TEXT_FIELD,hideField:!0}],A=[{name:I.BA,component:"review-actions"}],N=(e,t)=>({fields:[{component:C.Z.WIZARD,name:"remediations-wizard",isDynamic:!0,inModal:!0,showTitles:!0,title:"Remediate with Ansible",description:"Add actions to an Ansible Playbook",fields:[{name:"playbook",title:"Select playbook",fields:F(t),nextStep:"systems"},{name:"systems",title:"Review systems",fields:[{name:I.vF,component:"review-systems",validate:[{type:"validate-systems"}]}],nextStep:({values:e})=>(e=>(e[I.yu]?e[I.ko].filter((t=>!e[I.m0].issues.some((a=>a.id===t.id&&Object.keys(e[I.vF]).includes(t.id))))):e[I.ko].filter((t=>Object.keys(e[I.vF]).includes(t.id)))).length>0?"actions":"review")(e)},{name:"actions",title:"Review and edit actions",fields:A,nextStep:({values:e})=>(e=>{const t=e[I.yu]?e[I.ko].filter((t=>!e[I.m0].issues.some((e=>e.id===t.id))&&Object.keys(e[I.vF]).includes(t.id))):e[I.ko].filter((t=>Object.keys(e[I.vF]).includes(t.id)));return e[I.BA]?t[0]?.id:"review"})(e)},...e?.map((e=>({name:e.id,title:(0,I.u9)(e.id),showTitle:!1,fields:[{name:e.id,component:"issue-resolution",issue:e},{name:I.Tx,component:C.Z.TEXT_FIELD,hideField:!0}],nextStep:({values:t})=>((e,t)=>{const a=e[I.yu]?e[I.ko].filter((t=>!e[I.m0].issues.some((a=>a.id===t.id&&Object.keys(e[I.vF]).includes(t.id))))):e[I.ko].filter((t=>Object.keys(e[I.vF]).includes(t.id)));return a.slice(a.findIndex((e=>e.id===t.id))+1,a.length)[0]?.id||"review"})(t,e),substepOf:"Choose actions"})))||[],{name:"review",title:"Remediation review",fields:[{name:I.Ej,component:"review"}]}]}]});var O=a(26854),B=a(28685),$=a(9820),_=a(11395),P=a(81169),Z=a(48880),q=a(32819),z=a(4252),L=a(20211),V=a.n(L),G=a(3428);const D=e=>{const{resolutionsCount:t}=e,{input:a}=(0,P.Z)(e);return a.valid=!1,n().createElement(z.EmptyState,{variant:z.EmptyStateVariant.sm,"data-component-ouia-id":"wizard-fetch-error"},n().createElement(z.EmptyStateHeader,{titleText:"Unexpected error",icon:n().createElement(z.EmptyStateIcon,{color:G.ZP.value,icon:V()}),headingLevel:"h4"}),n().createElement(z.EmptyStateBody,null,"Please try again later."," ",0!==t&&n().createElement("div",null,"Hint: No resolutions for selected issues.")))};D.propTypes={resolutionsCount:o().number};const j=D;var W=a(79194),Y=a(39480),H=a(14832),U=a(36028),M=a(95499),X=a(26438),Q=a(40667),J=a(59671),K=a(31593),ee=a(13996),te=a(73363),ae=a(29521),se=a.n(ae),ne=a(18446),ie=a.n(ne);const oe=e=>{const{issues:t,systems:a,allSystems:i,remediationsList:o}=e,{input:l}=(0,P.Z)(e),r=(0,Z.default)(),c=r.getState().values,[m,u]=(0,s.useState)(!1),[p,y]=(0,s.useState)(),[g,E]=(0,s.useState)(c[I.yu]),[f,b]=(0,s.useState)(c[I.yu]?"":l.value),[v,k]=(0,s.useState)(c[I.m0]),[S,w]=(0,s.useState)(!1),T=(0,h.useSelector)((({resolutionsReducer:e})=>e?.errors||[]),h.shallowEqual),R=(0,h.useSelector)((({resolutionsReducer:e})=>e?.warnings||[]),h.shallowEqual),C=(0,h.useSelector)((({resolutionsReducer:e})=>e?.resolutions||[]),h.shallowEqual),x=(0,h.useSelector)((({resolutionsReducer:e})=>e?.isLoading));return(0,s.useEffect)((()=>{!async function(){const{data:e}=await d.lK();y(e)}()}),[]),(0,s.useEffect)((()=>{se()(C,c[I.Vf],ie())?.length>0&&(r.change(I.Vf,C),r.change(I.ko,(0,I.W3)(t,a,C)))})),T.length<=0?n().createElement(Q.Stack,{hasGutter:!0,"data-component-ouia-id":"wizard-select-playbook"},n().createElement(Q.StackItem,null,0!==R.length&&n().createElement(Q.StackItem,null,n().createElement(ee.Alert,{variant:"warning",isInline:!0,title:n().createElement(M.Text,null,"There ",(0,I._6)(R.length,"was","were")," ",n().createElement(J.Popover,{"aria-label":"Resolution error popover",bodyContent:n().createElement(s.Fragment,null,R.map(((e,t)=>n().createElement("div",{key:t},e))))},n().createElement("b",null,n().createElement(K.Button,{variant:"link",isInline:!0},R.length)," ",(0,I._6)(R.length,"error")))," ","while fetching resolutions for your issues!"," ")})),n().createElement(M.TextContent,null,n().createElement(M.Text,null,"You selected"," ",n().createElement("b",null,`${i.length} ${(0,I._6)(i.length,"system")}`," "),"to remediate with Ansible, which in total includes"," ",n().createElement("b",null,`${t?.length} ${(0,I._6)(t?.length,"issue")}`," "),t?.length===C.length||x?"which":n().createElement(s.Fragment,null,"of which ",n().createElement("b",null,C.length," "))," ","can be remediated by Ansible."))),n().createElement(Q.StackItem,null,n().createElement(Y.Grid,{hasGutter:!0},n().createElement(Y.GridItem,{sm:12,md:6,lg:4},n().createElement(H.Radio,{label:p?`Add to existing playbook (${p.length})`:"Add to existing playbook","aria-label":"Add to existing playbook",id:"existing",name:"radio",isDisabled:!p||!p.length,defaultChecked:g,onChange:()=>{E(!0),r.change(I.yu,!0),l.onChange(v?.name||""),r.change(I.m0,v)}})),n().createElement(Y.GridItem,{sm:12,md:6,lg:4},p&&!S?n().createElement(U.FormSelect,{onChange:(e,t)=>{w(!0),d.NH(t).then((e=>{k(e),w(!1),g&&l.onChange(e.name),g&&r.change(I.m0,e)}))},value:v?.id||"","aria-label":"Select an existing playbook"},p?.length?[n().createElement(U.FormSelectOption,{key:"select-playbook-placeholder","data-testid":"select-playbook-placeholder",value:"",label:"Select playbook",isDisabled:!0}),...p.map((({id:e,name:t})=>n().createElement(U.FormSelectOption,{key:e,value:e,label:t})))]:n().createElement(U.FormSelectOption,{key:"empty",value:"empty",label:"No existing playbooks"})):n().createElement(q.Z,{size:q.i.lg,"data-testid":"skeleton-loader"})))),n().createElement(Q.StackItem,null,n().createElement(Y.Grid,{hasGutter:!0},n().createElement(Y.GridItem,{sm:12,md:6,lg:4},n().createElement(H.Radio,{label:"Create new playbook","aria-label":"Create new playbook",id:"new",name:"radio",defaultChecked:!g,onChange:()=>{E(!1),r.change(I.yu,!1),l.onChange(f),r.change(I.m0,void 0)}})),n().createElement(Y.GridItem,{sm:12,md:6,lg:4},n().createElement(W.FormGroup,{fieldId:"remediation-name"},n().createElement(X.TextInput,{type:"text",value:f,onChange:(e,t)=>{(e=>{b(e),g||l.onChange(e);const t=e.trim();(()=>{const e={};o&&o.forEach((t=>{e[t.name]=!0})),e[t]?u(!0):u(!1)})()})(t)},"aria-label":"Name your playbook",autoFocus:!0,validated:m&&!g&&te.ValidatedOptions.error}),m&&!g&&n().createElement("p",{className:"pf-v5-u-font-size-sm pf-v5-u-danger-color-100"},"A playbook with the same name already exists within your organization. Try a different name.")))))):n().createElement(j,null)};oe.propTypes={issues:o().arrayOf(o().shape({description:o().string,id:o().string})).isRequired,systems:o().arrayOf(o().string).isRequired,allSystems:o().arrayOf(o().string).isRequired,remediationsList:o().array};const le=oe;var re=a(73399);const ce=({issues:e,systems:t,allSystems:a,registry:i,...o})=>{let l=(0,h.useDispatch)();const{input:r}=(0,P.Z)(o),c=(0,Z.default)(),m=c.getState().errors?.systems,[d,u]=(0,s.useState)(null),p=(0,h.useSelector)((({entities:e})=>(e?.rows||[]).length)),y=(0,h.useSelector)((({entities:e})=>e?.selected||[])),g=(0,h.useSelector)((({entities:e})=>e?.rows?.filter((e=>e.system_profile?.bootc_status?.booted?.image)).map((e=>e.id))||[])),E=(0,h.useSelector)((({entities:e})=>e?.loaded)),f=(0,h.useSelector)((({hostReducer:{hosts:e}})=>e?.map((e=>({id:e.id,name:e.display_name})))||[]));(0,s.useEffect)((()=>{const a=y.some((e=>g.includes(e))),s=e?.some((e=>e?.id?.startsWith("advisor")));if(a&&!s)return u("Image mode systems cannot be added to a remediation playbook."),r.onChange({});u(null);const n=e?.reduce(((e,a)=>{const s=(0,I.Y4)([...t,...a.systems||[]]).filter((e=>y?.includes(e)));return{...e,...s.length>0?{[a.id]:s}:{}}}),{});ie()(r.value,n)||r.onChange(n)}),[y]);const b=e=>{l({type:I.Zp,payload:e})};return n().createElement(Q.Stack,{hasGutter:!0,"data-component-ouia-id":"wizard-review-systems","data-testid":"wizard-review-systems"},n().createElement(Q.StackItem,null,n().createElement(M.TextContent,null,n().createElement(M.Text,null,"Review and optionally exclude systems from your selection."))),n().createElement(Q.StackItem,null,n().createElement(re.Z,{registry:i,allSystemsNamed:f,allSystems:a,hasCheckbox:!0,bulkSelect:{id:"select-systems",count:y.length,items:[{title:"Select none (0)",onClick:()=>b(!1)},...E&&p>0?[{title:`Select page (${p})`,onClick:()=>b(!0)}]:[]],checked:y.length>0,onSelect:e=>b(e)},onSelectRows:!0})),(d||m)&&E&&n().createElement(Q.StackItem,null,n().createElement(V(),{className:"ins-c-remediations-error pf-u-mr-sm"}),n().createElement("span",{className:"ins-c-remediations-error"},d||m)))};ce.propTypes={issues:o().arrayOf(o().shape({description:o().string,id:o().string})).isRequired,systems:o().arrayOf(o().string).isRequired,allSystems:o().arrayOf(o().string).isRequired,registry:o().instanceOf(f.ZP).isRequired};const me=ce;var de=a(75863),ue=a(7732),pe=a(5756),ye=a(43416),he=a(49004),ge=a(58027);const Ee=e=>{const t=(0,Z.default)().getState().values,a=e.issues.filter((e=>Object.keys(t[I.vF]).includes(e.id))),{input:i}=(0,P.Z)(e),[o,l]=(0,s.useState)({index:void 0,direction:void 0}),r=(0,h.useSelector)((({hostReducer:{hosts:e}})=>e?.map((e=>({id:e.id,name:e.display_name})))||[])),c=(t[I.yu]?t[I.ko].filter((e=>!t[I.m0].issues.some((t=>t.id===e.id)))):t[I.ko]).map((e=>({...e,systems:t[I.vF][e.id]}))).filter((e=>e?.systems?.length>0)),[m,d]=(0,s.useState)((0,I.TE)(c,o,!0,r));return(0,s.useEffect)((()=>{d((0,I.TE)(c,o,!0,r))}),[o]),n().createElement(Q.Stack,{hasGutter:!0,"data-component-ouia-id":"wizard-review-actions","data-testid":"wizard-review-actions"},n().createElement(Q.StackItem,null,n().createElement(M.TextContent,null,n().createElement(M.Text,null,"You have selected"," ",n().createElement("b",null,`${a.length} ${(0,I._6)(a.length,"item")}`)," to remediate."," ",n().createElement("b",null,c.length," of"," ",`${a.length} ${(0,I._6)(a.length,"item")}`),1!==c.length?" allow":" allows"," for you to chose from multiple resolution steps."))),n().createElement(Q.StackItem,null,n().createElement(H.Radio,{label:`Review and/or change the resolution steps for ${1!==c.length?"these":"this"}\n                         ${c.length} ${(0,I._6)(c.length,"action")}.`,id:"change",name:"radio",isChecked:i.value,onChange:()=>i.onChange(!0)}),a.length-c.length>0&&n().createElement(M.Text,{className:"rem-c-choose-actions-description"},`The ${a.length-c.length} other selected ${(0,I._6)(a.length-c.length,"issue")} \n                    ${a.length-c.length!=1?"do":"does"} not have multiple resolution options.`)),n().createElement(ye.i,{"aria-label":"Actions",className:"ins-c-remediation-summary-table",variant:de.B.compact,onCollapse:(e,t,a)=>(0,I.ar)(e,t,a,m,d),cells:[{title:"Action",transforms:[ue.p]},{title:"Resolution",transforms:[ue.p]},{title:"Reboot required",transforms:[ue.p]},{title:"Systems",transforms:[ue.p],cellFormatters:[pe.zW]}],rows:m,onSort:(e,t,a)=>l({index:t,direction:a}),sortBy:o},n().createElement(he.x,{noWrap:!0}),n().createElement(ge.R,null)),n().createElement(Q.StackItem,null,n().createElement(H.Radio,{label:"Accept all recommended resolution steps for all actions",id:"accept",name:"radio",isChecked:!i.value,onChange:()=>i.onChange(!1)}),n().createElement(M.Text,{className:"rem-c-choose-actions-description"},"You may modify reboot status to manual reboot in the next step, or from the playbook.")))};Ee.propTypes={issues:o().arrayOf(o().shape({description:o().string,id:o().string})).isRequired};const fe=Ee;var be=a(45997),ve=a(13193),ke=a(45578),Se=a.n(ke);const we=({issue:e})=>{const t=(0,Z.default)(),a=t.getState().values[I.Vf],i=t.getState().values[I.vF][e.id]||[],o=a.find((t=>t.id===e.id))?.resolutions||[],l=Se()(o,"id"),r=se()(o,l,ie());return n().createElement(Q.Stack,{hasGutter:!0,"data-component-ouia-id":"wizard-issue-resolution"},n().createElement(Q.StackItem,null,n().createElement(ve.Title,{headingLevel:"h2"},`Choose action: ${(0,I.u9)(e.id)}`)),n().createElement(Q.StackItem,null,r.length>0&&n().createElement(Q.StackItem,{className:"pf-u-mb-sm"},n().createElement(ee.Alert,{variant:"warning",isInline:!0,title:n().createElement(M.Text,null,"There ",(0,I._6)(r.length,"was","were")," ",n().createElement(J.Popover,{"aria-label":"Resolution duplicates popover",bodyContent:n().createElement(s.Fragment,null,r.map(((e,t)=>n().createElement("div",{key:t},e.description))))},n().createElement("b",null,n().createElement(K.Button,{variant:"link",isInline:!0},r.length)," ",(0,I._6)(r.length,"resolution")))," ","removed due to duplication")})),n().createElement(M.TextContent,null,n().createElement(M.Text,null,"Review the possible resolution steps and select which to add to your playbook."),n().createElement(M.Text,{className:"ins-c-remediations-action-description"},e.action),n().createElement(M.Text,{className:"ins-c-remediations-action-description"},`Resolution affects ${i.length} ${(0,I._6)(i.length,"system")}`))),n().createElement(Q.StackItem,null,n().createElement("div",{className:"ins-c-resolution-container"},l.map(((a,s)=>n().createElement("div",{className:"ins-c-resolution-option",key:a.id},n().createElement(be.Tile,{onClick:()=>t.change(I.Tx,{...t.getState().values[I.Tx],[e.id]:a.id}),isSelected:t.getState().values[I.Tx][e.id]?t.getState().values[I.Tx][e.id]===a.id:0===s,title:a.description},n().createElement(M.TextContent,{className:"pf-u-pt-sm"},n().createElement(M.Text,{className:"pf-u-mb-sm ins-c-playbook-description"},'Resolution from "',e.id.split(/:|\|/)[1],'"'),n().createElement("div",{className:"ins-c-reboot-required"},n().createElement(M.Text,{component:"span"},a.needs_reboot?"Reboot required":n().createElement("span",null,"Reboot ",n().createElement("b",null,"not")," required")))))))))))};we.propTypes={issue:o().shape({id:o().string,action:o().string,alternate:o().number,systems:o().arrayOf(o().string)}).isRequired};const Te=we;var Re=a(29738),Ce=a.n(Re),xe=a(70358);const Ie=e=>{const t=(0,Z.default)(),a=t.getState().values[I.m0],i=t.getState().values[I.yu],o=t.getState().values[I.vF],{data:l,issuesById:r}={...e,data:{...e.data,issues:e.data.issues.filter((e=>o[e.id]?.length>0))}},{input:c}=(0,P.Z)(e),[m,d]=(0,s.useState)({index:void 0,direction:void 0}),u=(0,h.useSelector)((({hostReducer:{hosts:e}})=>e?.map((e=>({id:e.id,name:e.display_name})))||[])),p=l.issues.map((e=>{const a=(0,I.uG)(e.id,t.getState().values),{description:s,needs_reboot:n}=a?.[0]||{};return{action:r[e.id].description,resolution:s,needsReboot:n,systems:o[e.id]}}));(0,s.useEffect)((()=>{c.onChange(""!==c.value?c.value:i&&a.auto_reboot||p.some((e=>e.needsReboot)))}),[]);const[y,g]=(0,s.useState)((0,I.TE)(p,m,!1,u));return(0,s.useEffect)((()=>{g((0,I.TE)(p,m,!1,u))}),[m]),n().createElement(Q.Stack,{hasGutter:!0,"data-component-ouia-id":"wizard-review","data-testid":"wizard-review"},n().createElement(Q.StackItem,null,n().createElement(M.TextContent,null,n().createElement(M.Text,null,"Issues listed below will be added to the playbook"," ",n().createElement("b",null,t.getState().values[I.mT]),"."))),p.some((e=>e.needsReboot))&&n().createElement(Q.StackItem,null,n().createElement(M.TextContent,null,n().createElement(M.Text,{className:"ins-c-playbook-reboot-required"},n().createElement(Ce(),null)," A system reboot is required to remediate selected issues"))),n().createElement(Q.StackItem,null,n().createElement(M.TextContent,null,n().createElement(M.Text,null,"The playbook ",n().createElement("b",null,t.getState().values[I.mT]),c.value?" does":n().createElement("span",{className:"ins-c-remediation-danger-text"}," does not")," ","auto reboot systems."))),n().createElement(Q.StackItem,null,n().createElement(xe.Switch,{"data-testid":"autoreboot-switch",label:"Turn off autoreboot",labelOff:"Turn on autoreboot",isChecked:c.value,onChange:()=>c.onChange(!c.value)})),n().createElement(ye.i,{"aria-label":"Actions",className:"ins-c-remediation-summary-table",variant:de.B.compact,cells:[{title:"Action",transforms:[ue.p]},{title:"Resolution",transforms:[ue.p]},{title:"Reboot required",transforms:[ue.p]},{title:"Systems",transforms:[ue.p],cellFormatters:[pe.zW]}],rows:y,onSort:(e,t,a)=>d({index:t,direction:a}),onCollapse:(e,t,a)=>(0,I.ar)(e,t,a,y,g),sortBy:m},n().createElement(he.x,{noWrap:!0}),n().createElement(ge.R,null)))};Ie.propTypes={data:o().shape({issues:o().array,systems:o().array,onRemediationCreated:o().func}).isRequired,issuesById:o().shape({[o().string]:o().shape({id:o().string,description:o().string})}).isRequired};const Fe=Ie,Ae={isLoading:!1,resolutions:void 0},Ne={[`${m.JY}_FULFILLED`]:(e,{payload:t})=>({...e,...t,isLoading:!1}),[`${m.JY}_PENDING`]:e=>({...e,isLoading:!0})};var Oe=a(48273);const Be=({percent:e,failed:t})=>{let a,s;return 100===e?(s="Completed",a=Oe.ProgressVariant.success):t?(s="Error",a=Oe.ProgressVariant.danger):(s="In progress",a=Oe.ProgressVariant.info),n().createElement(Oe.Progress,{"data-testid":"finished-create-remediation",value:e,title:s,variant:a})};Be.propTypes={percent:o().number,failed:o().bool};const $e=Be;var _e=a(44278),Pe=a.n(_e),Ze=a(40773),qe=a.n(Ze),ze=a(37248),Le=a.n(ze);const Ve=({onClose:e,setOpen:t,submitRemediation:a,setState:s,state:i})=>{const{percent:o,failed:l,systems:r,issues:c,playbook:m}={percent:i.percent,failed:i.failed,systems:(0,I.Y4)(Object.values(i.formValues[I.vF]).flat()),issues:Object.keys(i.formValues[I.vF]),playbook:{name:i.formValues[I.mT],id:i.id}};return n().createElement(z.EmptyState,{variant:z.EmptyStateVariant.lg,"data-testid":"wizard-progress","data-component-ouia-id":"wizard-progress"},n().createElement(z.EmptyStateHeader,{titleText:n().createElement(n().Fragment,null,l?"Error: Unable to add items to playbook":100===o?"Items added to playbook":"Adding items to the playbook"),icon:n().createElement(z.EmptyStateIcon,{className:"pf-u-mb-lg pf-u-mt-sm",color:l?"var(--pf-global--danger-color--100)":100===o?"var(--pf-global--success-color--100)":void 0,icon:l?V():100===o?Pe():Le()}),headingLevel:"h1"}),n().createElement(z.EmptyStateBody,{className:"pf-c-progress-bar pf-u-mt-md"},n().createElement($e,{percent:o,failed:l})),n().createElement(z.EmptyStateFooter,null,(l||100===o)&&n().createElement(z.EmptyStateBody,{className:"pf-c-progress-message"},l?"Please try again.":n().createElement("div",null,`${c.length} ${(0,I._6)(c.length,"action")} affecting \n                        ${r.length} ${(0,I._6)(r.length,"system")} \n                        ${c.length>1?"were":"was"} added to the playbook `,n().createElement("a",{href:(0,I.B3)(m.id)},m.name),".")),100===o&&n().createElement(z.EmptyStateBody,{className:"pf-c-progress-message-description pf-u-mb-md"},"You can remediate these systems directly from Insights by enabling",n().createElement(K.Button,{className:"pf-u-py-0 pf-u-px-xs",variant:"link",ouiaId:"CloudConnectorButton",icon:n().createElement(qe(),null),iconPosition:"right",size:"sm",onClick:()=>window.location.href=`${window.location.origin}/${(0,I.QU)()}settings/connector`},"Cloud Connector"),"on eligible systems."),l&&n().createElement(K.Button,{className:"pf-u-mt-md pf-u-mb-sm",variant:"primary",ouiaId:"TryAgainButton","data-testid":"TryAgainButton",onClick:()=>{s({failed:!1,percent:0}),a(!1)}},"Try again"),100===o&&n().createElement(K.Button,{className:"pf-u-mt-md pf-u-mb-sm",variant:"primary",ouiaId:"ReturnToAppButton",onClick:()=>{e(),t(!1)}},"Return to application"),n().createElement(z.EmptyStateActions,null,l&&n().createElement(K.Button,{variant:"secondary",ouiaId:"BackToWizardButton","data-testid":"BackToWizardButton",onClick:()=>{e()}},"Go back to the wizard"),100===o&&n().createElement(K.Button,{variant:"link",component:"a",ouiaId:"OpenPlaybookButton","data-testid":"OpenPlaybookButton",href:(0,I.B3)(m.id),onClick:()=>{e(),t(!1)}},"Open playbook ",m.name))))};Ve.propTypes={onClose:o().func,setOpen:o().func,submitRemediation:o().func,setState:o().func,state:o().shape({id:o().string,percent:o().number.isRequired,failed:o().bool.isRequired,formValues:o().shape({[I.mT]:o().string,[I.vF]:o().objectOf(o().arrayOf(o().string))})})};const Ge=Ve;var De=a(79790);const je={submitted:!1,id:void 0,percent:0,failed:!1,formValues:void 0},We=(e,t)=>{switch(t.type){case"schema":return{...e,schema:t.payload};case"state":return{...e,...t.payload};default:throw new Error}},Ye=({setOpen:e,data:t,basePath:a,registry:i})=>{const o=(0,s.useRef)((0,I.Y4)(t.issues?.reduce(((e,t)=>[...e,...t.systems||[]]),[...t.systems||[]]))),l=(0,De.Q)(),r=(0,h.useDispatch)(),[d,u]=(0,s.useReducer)(We,je),p=w()(t.issues,(e=>e.id));(0,s.useEffect)((()=>{l&&u({type:"schema",payload:N(t.issues,l)}),i.register({hostReducer:(0,k.applyReducerHash)(v,b),resolutionsReducer:(0,k.applyReducerHash)(Ne,Ae)}),r(((e=[])=>({type:m.JY,payload:y(e)}))(t.issues)),((e=[])=>{(0,I.C1)(e,50).forEach((e=>{r(((e,t={})=>({type:m.mg,payload:c(e,t)}))(e,{page:1,perPage:50}))}))})(o.current)}),[l]);const g={"select-playbook":{component:le,issues:t.issues,systems:t.systems,allSystems:o.current,remediationsList:l},"review-systems":{component:me,issues:t.issues,systems:t.systems||[],allSystems:o.current,registry:i},"review-actions":{component:fe,issues:t.issues},"issue-resolution":{component:Te},review:{component:Fe,data:t,issuesById:p}},E={"validate-systems":()=>e=>e&&Object.values(e).filter((e=>void 0!==e)).length?void 0:"At least one system must be selected. Actions must be associated to a system to be added to a playbook."};return n().createElement(s.Fragment,null,d.schema&&!d.submitted?n().createElement(T.Z,{schema:d.schema,subscription:{values:!0},FormTemplate:e=>n().createElement(R.ZP,{...e,showFormControls:!1}),initialValues:{[I.Vf]:[],[I.ko]:[],[I.vF]:{},[I.BA]:!0,[I.Tx]:{},[I.yu]:!1},componentMapper:{[C.Z.WIZARD]:{component:O.Z,className:"remediations","data-ouia-component-id":"remediation-wizard"},[C.Z.TEXT_FIELD]:_.Z,...g},validatorMapper:E,onSubmit:e=>{u({type:"state",payload:{submitted:!0,formValues:e}}),(0,I.ec)(e,t,a,(e=>u({type:"state",payload:e})))},onCancel:()=>e(!1)}):null,d.submitted?n().createElement(B.Modal,{isOpen:!0,variant:B.ModalVariant.large,showClose:!1,className:"remediations",hasNoBodyWrapper:!0,"aria-describedby":"wiz-modal-description","aria-labelledby":"wiz-modal-title"},n().createElement($.e,{className:"remediations",title:"Remediate with Ansible",description:"Add actions to an Ansible Playbook",steps:[{name:"progress",component:n().createElement(Ge,{onClose:()=>{u({type:"state",payload:{submitted:!1,id:void 0,failed:!1,formValues:void 0}})},title:"Adding items to the playbook",setOpen:e,submitRemediation:()=>(0,I.ec)(d.formValues,t,a,(e=>u({type:"state",payload:e}))),setState:e=>u({type:"state",payload:e}),state:d}),isFinishedStep:!0}],onClose:()=>{u({type:"state",payload:{submitted:!1,id:void 0,failed:!1,formValues:void 0}}),e(!1)}})):null)};Ye.propTypes={setOpen:o().func.isRequired,data:o().shape({issues:o().arrayOf(o().shape({description:o().string,id:o().string})),systems:o().arrayOf(o().string),onRemediationCreated:o().func}).isRequired,basePath:o().string,registry:o().shape({register:o().func}).isRequired,remediationsList:o().array};const He=e=>{const[t,a]=(0,s.useState)();return(0,s.useEffect)((()=>{a((()=>new f.ZP({},[E()])))}),[]),t?.store?n().createElement(h.Provider,{store:t.store},n().createElement(Ye,{...e,registry:t})):null}},65088:()=>{}}]);
//# sourceMappingURL=../sourcemaps/2179.b41c088f0d795adf2ef0125b66b5993c.js.map