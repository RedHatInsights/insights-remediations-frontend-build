(self.webpackChunkremediations=self.webpackChunkremediations||[]).push([[6408,5467,8681],{10621:(e,t,s)=>{"use strict";s.d(t,{B3:()=>w,BA:()=>f,C1:()=>k,Ej:()=>p,FH:()=>u,Kq:()=>L,P9:()=>Y,QU:()=>T,SG:()=>B,TE:()=>N,Tx:()=>m,Vf:()=>_,W3:()=>$,Y4:()=>I,Zp:()=>A,_6:()=>O,ar:()=>C,ec:()=>b,kC:()=>d,ko:()=>g,m0:()=>y,mT:()=>E,u9:()=>U,uG:()=>P,vF:()=>S,yu:()=>h});var n=s(10756),r=s.n(n),i=s(45791),o=s(75796),a=s(33626),l=(s(70851),s(18446),s(39133)),c=s(73399);function d(e){return`${e.charAt(0).toUpperCase()+e.slice(1)}`}const u="remediations:remediation:write",p="auto-reboot",E="select-playbook",m="selected-resolutions",f="manual-resolution",h="existing-playbook-selected",y="existing-playbook",S="systems",_="resolutions",g="issues-multiple",A="toggle-bulk-select",T=()=>"preview"===window.location.pathname.split("/")[1]?"preview/":"",w=e=>`${document.baseURI.replace("preview/","")}${T()}${window.location.pathname.split("/").filter((e=>"preview"!==e&&e.length>0)).shift()}/remediations${e?`/${e}`:""}`,I=e=>[...new Set(e)],O=(e,t,s)=>1!==e?s||t+"s":t,N=(e,t,s,a)=>((e,t)=>[...e].sort(((e,s)=>{const n=Object.keys(e)[t.index-1];return(e[n]>s[n]?1:e[n]<s[n]?-1:0)*("desc"===t.direction?-1:1)})))(e,t).reduce(((e,t,l)=>[...e,{isOpen:!1,cells:[{title:t.action},{title:r().createElement(n.Fragment,{key:`${l}-description`},r().createElement("p",{key:`${l}-resolution`},t.resolution),s&&t.alternate>0&&r().createElement("p",{key:`${l}-alternate`},t.alternate," alternate"," ",O(t.alternate,"resolution")))},{title:t.needsReboot?r().createElement("div",null,"Required"):r().createElement("div",null,"Not required")},{title:t.systems?.length||0,props:{isOpen:!1}}]},...t.systems?.length>0?[{parent:2*l,fullWidth:!0,allSystemsNamed:a.filter((e=>t.systems.includes(e.id))),allSystems:t.systems,cells:[{title:r().createElement(i.Bullseye,null,r().createElement(o.Spinner,null)),props:{colSpan:5,className:"pf-m-no-padding"}}]}]:[]]),[]),R=(e=[],t=[])=>r().createElement(c.M,{allSystemsNamed:e,allSystems:t,disabledColumns:["updated"]}),C=(e,t,s,n,r)=>{let i=[...n];n[t].isOpen=s,i[t+1].cells=[{title:R(n[t+1].allSystemsNamed,n[t+1].allSystems)}],r(i)},P=(e,t)=>{const s=t[_].find((t=>t.id===e))?.resolutions||[];if(t[f]&&e in t[m])return s.filter((s=>s.id===t[m][e]));if(t[h]){const n=t[y]?.issues?.find((t=>t.id===e));if(n)return s.filter((e=>e.id===n.resolution.id))}return s},b=(e,t,s,n)=>{let i=1;n({percent:i});const o=t.issues.map((({id:t})=>{const s=e[y]?.issues?.find((e=>e.id===t))?.systems?.map((e=>e.id))||[];return{id:t,resolution:P(t,e)?.[0]?.id,systems:I([...e[h]?[]:s,...e[S][t]||[]])}})).filter((e=>e.systems.length>0)),l=setInterval((()=>{i<99&&n({percent:++i})}),(o.length+Object.keys(e[S]).length)/10),c={issues:o,systems:[]},{id:d}=e[y]||{},u=e[h];(u&&a.o6(d,{add:c,auto_reboot:e[p]},s)||a.GZ({name:e[E],add:c,auto_reboot:e[p]},s)).then((({id:s})=>{n({id:s??d,percent:100}),t?.onRemediationCreated?.({remediation:{id:s,name},getNotification:()=>function(e,t,s){const n=s?"created":"updated";return{variant:"success",title:`Playbook ${n}`,description:r().createElement("span",null,"You have successfully ",n," ",r().createElement("a",{href:w(e)},t),"."),dismissable:!0}}(s??d,e[E],!u)})})).catch((()=>{n({failed:!0})})).finally((()=>clearInterval(l)))},D=(e,t)=>{const s=!t.payload;return s||(e.selected=I([...e.selected,...e.rows.map((e=>e.id))])),{...e,selected:s?[]:e.selected,rows:e.rows.map((({id:e,...t})=>({id:e,...t,selected:!s})))}},v=(e,t,s)=>Array.isArray(e)?e.sort(((e,n)=>(e[t]>n[t]?1:-1)*("asc"===s?1:-1))):[],B=async(e,t=[],s=[],n)=>{const r=t.includes(e.orderBy);e.orderBy=r?e.orderBy:void 0,e.orderDirection=r?e.orderDirection?.toLowerCase():void 0,s=v(s,"name",e.orderDirection);const i=e?.filters?.hostnameOrId?.toLowerCase(),o=i?s.reduce(((e,t)=>[...e,...t.name.toLowerCase().includes(i)?[t.id]:[]]),[]):s.map((e=>e.id)),a=o.slice((e.page-1)*e.per_page,e.page*e.per_page),l=a.length>0?await n(a,{...e,hasItems:!0,page:1},!0):{};return{...{...l,results:v(l.results,"display_name",e.orderDirection)},total:o.length,page:e.page,per_page:e.per_page,orderBy:e.orderBy,orderDirection:e.orderDirection,sortBy:{key:e.orderBy,direction:e.orderDirection}}},k=(e,t)=>[...new Array(Math.ceil(e.length/t))].map(((s,n)=>e.slice(n*t,(n+1)*t))),L=(e,{LOAD_ENTITIES_FULFILLED:t})=>(0,l.applyReducerHash)({SELECT_ENTITY:(e,t)=>((e,{payload:t})=>{let s=e.selected||[];if(t.selected)s=[...s,...0===t.id?e.rows.map((e=>e.id)):[t.id]];else if(0===t.id){const t=e.rows.map((e=>e.id));s=s.filter((e=>!t.includes(e)))}else s=-1===t.id?[]:s.filter((e=>e!==t.id));return{...e,selected:s}})(e,t),[t]:(t,{payload:s})=>((e,t,s)=>{let n=e.selected||[];return e.selected||(n=t||e.rows.map((e=>e.id))),{...e,selected:n,rows:v(e.rows.map((({id:e,...t})=>({id:e,...t,selected:!!n?.includes(e)}))),"display_name",s?.direction||"asc"),sortBy:s}})(t,e,{key:s.orderBy,direction:s.orderDirection}),[A]:D}),U=e=>e?.split("|")?.slice(-1)?.[0]||e,$=(e=[],t=[],s=[])=>e.map((n=>{const r=s.find((e=>e.id===n.id))?.resolutions||[],{description:i,needs_reboot:o}=r?.[0]||{};return{action:e.find((e=>e.id===n.id)).description,resolution:i,needsReboot:o,systems:I([...n.systems||[],...t]),id:n.id,alternate:r?.length-1}})).filter((e=>e.alternate>0)),Y=(e,t)=>{const s=e.split(":"),n=t.split(":");return s.length===n.length&&s.every(((e,t)=>e===n[t]||"*"===e||"*"===n[t]))}},33626:(e,t,s)=>{"use strict";s.d(t,{GZ:()=>R,yc:()=>w,rN:()=>A,yY:()=>f,kd:()=>T,NH:()=>b,uQ:()=>m,lK:()=>P,mY:()=>D,o6:()=>C,V_:()=>S,_5:()=>_,YI:()=>g});var n=s(93940),r=s(11521),i=s.n(r),o=s(67450),a=s(64517);class l extends Error{constructor(e){super("Error communicating with the server"),this.description=e}}async function c(e){if(e.ok)return e;if(e.headers.get("content-type").includes("application/json")){let t=!1;try{t=await e.json()}catch(e){}if(t.errors&&t.errors.length){const e=t.errors[0];if(e.details&&e.details.name)throw new l(`${e.title} (${e.details.name})`);throw new l(e.title)}}throw new l(`Unexpected response code ${e.status}`)}async function d(e){if(!e)return;const t=e.headers.get("content-type");if(!t.includes("application/json"))throw new l(`Unexpected response type (${t}) returned`);return e.json()}function u(e){return function(e,t="GET",s=!1,n=!1,r={}){const i={credentials:"same-origin",method:t,...r};return n&&(i.headers=n),s&&(i.body=JSON.stringify(s)),fetch(e,i)}(e.toString()).then(c).then(d)}var p=s(54998),E=s.n(p);const m=e=>u(function(...e){const t=E()(n.API_BASE).segment("remediations");return e.forEach((e=>t.segment(e))),t}(e,"status"));function f(){return u("/api/inventory/v1/hosts")}class h extends Error{constructor(e){super("Error communicating with the server"),this.description=e}}const y=i().create();y.interceptors.request.use((async function(e){return e})),y.interceptors.response.use((function(e){return e.data?{...e.data,etag:e.headers.etag}:e})),y.interceptors.response.use(null,(function(e){if(e){if(e.response&&401===e.response.status)return!1;throw e}})),y.interceptors.response.use(null,(function(e){if(e){if(e.response&&e.response.data&&e.response.data.errors&&e.response.data.errors.length){const t=e.response.data.errors[0];if(t.details&&t.details.name)throw new h(`${t.title} (${t.details.name})`);throw new h(t.title)}throw e}}));const S=new o.RemediationsApi(void 0,n.API_BASE,y),_=new o.ResolutionsApi(void 0,n.API_BASE,y),g=new a.DefaultApi(void 0,n.SOURCES_BASE,y);function A(e){return new Promise(((t,s)=>{const r=e.length>1?(new o.RemediationsApiAxiosParamCreator).downloadPlaybooks(e).then((e=>window.location.assign(n.API_BASE+e.url))):(new o.RemediationsApiAxiosParamCreator).getRemediationPlaybook(e[0]).then((e=>window.location.assign(n.API_BASE+e.url)));if(!r)return s();const i=setInterval((()=>{r.closed&&(clearInterval(i),t())}),500)}))}function T(){return u(`${window.location.origin}/api/sources/v2.0/endpoints?filter[receptor_node][not_nil]`)}function w(e,t){return Promise.all(e.flatMap((e=>e.issues.map((s=>S.deleteRemediationIssueSystem(t.id,s.id,e.id))))))}function I(e){if(!e.ok){const t=new Error(`Unexpected response code ${e.status}`);throw t.statusCode=e.status,t}return e}function O(e){return I(e),e.json()}const N=Object.freeze({"Content-Type":"application/json; charset=utf-8"});function R(e){const t=new(E())(n.API_BASE).segment("remediations").toString();return fetch(t,{headers:N,method:"POST",credentials:"include",body:JSON.stringify(e)}).then(O)}function C(e,t){const s=new(E())(n.API_BASE).segment("remediations").segment(e).toString();return fetch(s,{headers:N,credentials:"include",method:"PATCH",body:JSON.stringify(t)}).then(I)}function P(){const e=new(E())(n.API_BASE).segment("remediations").query({limit:200}).toString();return fetch(e,{credentials:"include"}).then(O)}function b(e){const t=new(E())(n.API_BASE).segment("remediations").segment(e).toString();return fetch(t,{credentials:"include"}).then(O)}function D(e){const t=new(E())(n.API_BASE).segment("resolutions").toString();return fetch(t,{headers:N,credentials:"include",method:"POST",body:JSON.stringify({issues:e})}).then(O)}},93940:(e,t,s)=>{"use strict";s.r(t),s.d(t,{API_BASE:()=>n,SOURCES_BASE:()=>r});const n="/api/remediations/v1",r="/api/sources/v2.0"},37468:(e,t,s)=>{"use strict";s.d(t,{ET:()=>l,JY:()=>d,aI:()=>a,mg:()=>c});var n=s(24350),r=s.n(n),i=s(94654);const o=s.n(i)()(["LOAD_REMEDIATIONS","CREATE_REMEDIATIONS","LOAD_REMEDIATION","LOAD_REMEDIATION_STATUS","REFRESH_REMEDIATION","PATCH_REMEDIATION","DELETE_REMEDIATION","DELETE_REMEDIATION_ISSUE","DELETE_REMEDIATION_ISSUE_SYSTEM","PATCH_REMEDIATION_ISSUE","GET_RESOLUTIONS","GET_CONNECTION_STATUS","RUN_REMEDIATION","EXECUTE_PLAYBOOK_BANNER","RUN_REMEDIATION","GET_PLAYBOOK_RUNS","GET_PLAYBOOK_RUN","GET_PLAYBOOK_RUN_SYSTEMS","GET_PLAYBOOK_RUN_SYSTEM_DETAILS","CANCEL_PLAYBOOK_RUNS","GET_ENDPOINT","CHECK_EXECUTABLE"],(e=>[e,`${e}_PENDING`,`${e}_FULFILLED`,`${e}_REJECTED`])),a=r()([...o,"SET_ETAG","EXPAND_INVENTORY_TABLE","SELECT_ENTITY"],(e=>e)),l=500,c="FETCH_SELECTED_HOSTS",d="FETCH_RESOLUTIONS"},73399:(e,t,s)=>{"use strict";s.d(t,{M:()=>f,Z:()=>h});var n=s(10756),r=s.n(n),i=s(28216),o=s(45697),a=s.n(o),l=s(57283),c=s.n(l),d=s(18546),u=s(93254),p=s.n(u),E=s(10621);const m=({registry:e,allSystemsNamed:t,allSystems:s,hasCheckbox:i,disabledColumns:o,bulkSelect:a})=>{const l=(0,n.useRef)(null),c=["display_name"];return r().createElement(p(),{hideFilters:{tags:!0,registeredWith:!0,stale:!0},columns:e=>e.reduce(((e,t)=>[...e,...o.includes(t.key)?[]:[{...t,props:{...t.props||{},isStatic:!c.includes(t.key)}}]]),[]),noDetail:!0,variant:"compact",hasCheckbox:i,showTags:!0,bulkSelect:a,ref:l,getEntities:(e,s,n,r)=>(0,E.SG)(s,c,t,r),onLoad:({mergeWithEntities:t,INVENTORY_ACTION_TYPES:n})=>{e.register(t((0,E.Kq)(s,n)))},tableProps:{canSelectAll:!1}})};m.defaultProps={disabledColumns:[],hasCheckbox:!1},m.propTypes={registry:a().instanceOf(d.ZP).isRequired,allSystemsNamed:a().arrayOf(a().shape({id:a().string,name:a().string})).isRequired,allSystems:a().arrayOf(a().string).isRequired,hasCheckbox:a().bool,disabledColumns:a().arrayOf(a().string),bulkSelect:a().object};const f=e=>{const[t,s]=(0,n.useState)();return(0,n.useEffect)((()=>{s((()=>new d.ZP({},[c()])))}),[]),t?.store?r().createElement(i.Provider,{store:t.store},r().createElement("div",{className:"pf-u-pl-lg"},r().createElement(m,{...e,registry:t}))):null},h=m},45467:()=>{},36150:()=>{},63498:()=>{},36213:()=>{},81235:()=>{},81754:()=>{},16506:()=>{},43109:()=>{},70347:()=>{},12796:()=>{},11452:()=>{},95594:()=>{},15622:()=>{},58392:()=>{},34946:()=>{},10497:()=>{},80598:()=>{},32857:()=>{},1580:()=>{},94498:()=>{},37625:()=>{},71644:()=>{},10108:()=>{},23055:()=>{},54476:()=>{},27567:()=>{},28992:()=>{},90146:()=>{},80897:()=>{},40837:()=>{},81320:()=>{},88361:()=>{},50311:()=>{},90479:()=>{},78752:()=>{},71338:()=>{},11080:()=>{},44839:()=>{},21626:()=>{},74282:()=>{},67274:()=>{},24620:()=>{},82014:()=>{},90776:()=>{},88277:()=>{},97939:()=>{},8572:()=>{},98379:()=>{},25238:()=>{},61612:()=>{},33858:()=>{},66213:()=>{},77350:()=>{},69076:()=>{},70150:()=>{},92084:()=>{},46928:()=>{},1508:()=>{},91993:()=>{},84958:()=>{},37739:()=>{},99624:()=>{},43919:()=>{},91027:()=>{},53336:()=>{},16061:()=>{},27479:()=>{},66822:()=>{},93661:()=>{},56024:()=>{},54994:()=>{},44690:()=>{},37494:()=>{},67761:()=>{},43390:()=>{},22143:()=>{},48223:()=>{},7064:()=>{},314:()=>{},97853:()=>{},97236:()=>{},49854:()=>{},38024:()=>{},11489:()=>{},40209:()=>{},87234:()=>{},38299:()=>{},51934:()=>{},72816:()=>{},74181:()=>{},16166:()=>{},53519:()=>{},24654:()=>{}}]);
//# sourceMappingURL=../../sourcemaps/exposed-./RemediationWizard.8ce7354ad688f7aacfceff765a23e9d5.js.map