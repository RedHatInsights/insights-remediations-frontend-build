(self.webpackChunkremediations=self.webpackChunkremediations||[]).push([[1891],{79790:(e,t,a)=>{"use strict";a.d(t,{Q:()=>i});var s=a(33366),n=a(10756);const{API_BASE:o}=a(93940),i=e=>{const t=(0,s.Vk)(),[a,i]=(0,n.useState)(),l=(0,n.useRef)(!1);return(0,n.useEffect)((()=>(l.current=!0,(async()=>{try{const e=await t.get(`${o}/remediations/?fields[data]=name`);l.current&&i(e.data)}catch(e){console.error(e)}})(),()=>{l.current=!1})),[e]),a}},2611:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Qe});var s=a(10756),n=a.n(s),o=a(45697),i=a.n(o),l=a(33366);const r=new(a(68004).HostsApi)(void 0,"/api/inventory/v1",l.ZP);function c(e,{page:t,perPage:a}){return r.apiHostGetHostById(e,void 0,a,t)}var d=a(37468),m=a(33626),u=a(68718),p=a.n(u);const y=async e=>{try{const t=await m.mY(e.map((e=>e.id))),[a,s]=p()(t,(([e,t],a,s)=>(a?e.push(a):t.push(`Issue ${s} does not have Ansible support`),[e,t])),[[],[]]);return{resolutions:a,warnings:s}}catch(e){return{errors:["Error obtaining resolution information. Please try again later."]}}};var h=a(28216),g=a(57283),E=a.n(g),f=a(18546);const b={isLoading:!1,hosts:[]},v={[`${d.mg}_FULFILLED`]:(e,{payload:t})=>({...e,hosts:[...e.hosts,...t.results||[]],isLoading:!1}),[`${d.mg}_PENDING`]:e=>({...e,isLoading:!0})};var S=a(39133),k=a(24350),w=a.n(k),T=a(51912),R=a(67850),C=a(96354),x=a(64124),I=a(10621);const A=e=>[{name:I.mT,component:"select-playbook",validate:[{type:x.Z.PATTERN,pattern:/^$|^.*[\w\d]+.*$/},{type:x.Z.REQUIRED},(t,a)=>{if(!a[I.yu]&&t)return((e,t)=>(()=>{const a=e.trim(),s={};return t&&t.forEach((e=>{s[e.name]=!0})),!!s[a]})())(t,e)?"A playbook with the same name already exists within your organization. Try a different name.":void 0}]},{name:I.yu,component:C.Z.TEXT_FIELD,hideField:!0},{name:I.m0,component:C.Z.TEXT_FIELD,hideField:!0},{name:I.Vf,component:C.Z.TEXT_FIELD,hideField:!0}],F=[{name:I.BA,component:"review-actions"}],O=(e,t)=>({fields:[{component:C.Z.WIZARD,name:"remediations-wizard",isDynamic:!0,inModal:!0,showTitles:!0,title:"Remediate with Ansible",description:"Add actions to an Ansible Playbook",fields:[{name:"playbook",title:"Select playbook",fields:A(t),nextStep:"systems"},{name:"systems",title:"Review systems",fields:[{name:I.vF,component:"review-systems",validate:[{type:"validate-systems"}]}],nextStep:({values:e})=>(e=>(e[I.yu]?e[I.ko].filter((t=>!e[I.m0].issues.some((a=>a.id===t.id&&Object.keys(e[I.vF]).includes(t.id))))):e[I.ko].filter((t=>Object.keys(e[I.vF]).includes(t.id)))).length>0?"actions":"review")(e)},{name:"actions",title:"Review and edit actions",fields:F,nextStep:({values:e})=>(e=>{const t=e[I.yu]?e[I.ko].filter((t=>!e[I.m0].issues.some((e=>e.id===t.id))&&Object.keys(e[I.vF]).includes(t.id))):e[I.ko].filter((t=>Object.keys(e[I.vF]).includes(t.id)));return e[I.BA]?t[0]?.id:"review"})(e)},...e?.map((e=>({name:e.id,title:(0,I.u9)(e.id),showTitle:!1,fields:[{name:e.id,component:"issue-resolution",issue:e},{name:I.Tx,component:C.Z.TEXT_FIELD,hideField:!0}],nextStep:({values:t})=>((e,t)=>{const a=e[I.yu]?e[I.ko].filter((t=>!e[I.m0].issues.some((a=>a.id===t.id&&Object.keys(e[I.vF]).includes(t.id))))):e[I.ko].filter((t=>Object.keys(e[I.vF]).includes(t.id)));return a.slice(a.findIndex((e=>e.id===t.id))+1,a.length)[0]?.id||"review"})(t,e),substepOf:"Choose actions"})))||[],{name:"review",title:"Remediation review",fields:[{name:I.Ej,component:"review"}]}]}]});var N=a(26854),P=a(28685),B=a(9820),$=a(11395),L=a(81169),_=a(48880),Z=a(32819),q=a(4252),z=a(20211),V=a.n(z),D=a(3428);const G=e=>{const{resolutionsCount:t}=e,{input:a}=(0,L.Z)(e);return a.valid=!1,n().createElement(q.EmptyState,{variant:q.EmptyStateVariant.sm,"data-component-ouia-id":"wizard-fetch-error"},n().createElement(q.EmptyStateHeader,{titleText:"Unexpected error",icon:n().createElement(q.EmptyStateIcon,{color:D.ZP.value,icon:V()}),headingLevel:"h4"}),n().createElement(q.EmptyStateBody,null,"Please try again later."," ",0!==t&&n().createElement("div",null,"Hint: No resolutions for selected issues.")))};G.propTypes={resolutionsCount:i().number};const j=G;var W=a(82023),Y=a(95009),H=a(13186);const U=({selectedPlaybook:e,setIsLoadingRemediation:t,setSelectedPlaybook:a,existingPlaybookSelected:o,existingRemediations:i,input:l,formOptions:r})=>{const[c,d]=(0,s.useState)(!1),[u,p]=(0,s.useState)(e?.name),[y,h]=(0,s.useState)(""),[g,E]=(0,s.useState)(i),[f,b]=(0,s.useState)(null),[v,S]=(0,s.useState)(null),k=(0,s.useRef)();(0,s.useEffect)((()=>{let e=i;y&&(e=i.filter((e=>String(e.name).toLowerCase().includes(y.toLowerCase()))),e.length||(e=[{name:`No results found for "${y}"`}]),c||d(!0)),E(e),S(null),b(null)}),[y]);const w=()=>{d(!c)},T=(e,s)=>{t(!0),(0,m.NH)(s).then((e=>{a(e),t(!1),o&&(p(e.name),h(""),l.onChange(e.name),r.change(I.m0,e))}))},R=(e,t)=>{h(t),p(t)},C=e=>{const t=g.filter((e=>!e.isDisabled)),[a]=t,s=f?t[f]:a;switch(e.key){case"Enter":c&&!s.name.includes("No results found for")&&T(0,s.id),d((e=>!e)),b(null),S(null);break;case"ArrowUp":case"ArrowDown":e.preventDefault(),(e=>{let t;if(c){"ArrowUp"===e&&(t=null===f||0===f?g.length-1:f-1),"ArrowDown"===e&&(t=null===f||f===g.length-1?0:f+1),b(t);const a=g.filter((e=>!e.isDisabled))[t];S(`select-typeahead-${a.name.replace(" ","-")}`)}})(e.key)}};return n().createElement(W.Select,{id:"typeahead-select-existing-playbook",isOpen:c,selected:e?.name,onSelect:T,onOpenChange:()=>{d(!1)},toggle:e=>n().createElement(Y.MenuToggle,{ref:e,variant:"typeahead","aria-label":"Typeahead menu toggle",onClick:w,isExpanded:c},n().createElement(H.TextInputGroup,{isPlain:!0},n().createElement(H.TextInputGroupMain,{value:u,onClick:w,onChange:R,onKeyDown:C,id:"typeahead-select-input",autoComplete:"off",innerRef:k,placeholder:"Select playbook",...v&&{"aria-activedescendant":v},role:"combobox",isExpanded:c,"aria-controls":"select-typeahead-listbox"}))),isScrollable:!0},n().createElement(W.SelectList,{id:"select-typeahead-listbox"},g.map(((e,t)=>n().createElement(W.SelectOption,{key:e.id,value:e.id,isFocused:f===t,id:e.id},e.name)))))};U.propTypes={selectedPlaybook:i().object,setIsLoadingRemediation:i().func,setSelectedPlaybook:i().func,existingPlaybookSelected:i().bool,existingRemediations:i().array,input:i().object,formOptions:i().object};const M=U;var X=a(79194),Q=a(39480),J=a(14832),K=a(95499),ee=a(26438),te=a(40667),ae=a(59671),se=a(31593),ne=a(13996),oe=a(73363),ie=a(29521),le=a.n(ie),re=a(18446),ce=a.n(re);const de=e=>{const{issues:t,systems:a,allSystems:o,remediationsList:i}=e,{input:l}=(0,L.Z)(e),r=(0,_.default)(),c=r.getState().values,[d,u]=(0,s.useState)(!1),[p,y]=(0,s.useState)(),[g,E]=(0,s.useState)(c[I.yu]),[f,b]=(0,s.useState)(c[I.yu]?"":l.value),[v,S]=(0,s.useState)(c[I.m0]),[k,w]=(0,s.useState)(!1),T=(0,h.useSelector)((({resolutionsReducer:e})=>e?.errors||[]),h.shallowEqual),R=(0,h.useSelector)((({resolutionsReducer:e})=>e?.warnings||[]),h.shallowEqual),C=(0,h.useSelector)((({resolutionsReducer:e})=>e?.resolutions||[]),h.shallowEqual),x=(0,h.useSelector)((({resolutionsReducer:e})=>e?.isLoading));return(0,s.useEffect)((()=>{!async function(){const{data:e}=await m.lK();y(e)}()}),[]),(0,s.useEffect)((()=>{le()(C,c[I.Vf],ce())?.length>0&&(r.change(I.Vf,C),r.change(I.ko,(0,I.W3)(t,a,C)))})),T.length<=0?n().createElement(te.Stack,{hasGutter:!0,"data-component-ouia-id":"wizard-select-playbook"},n().createElement(te.StackItem,null,0!==R.length&&n().createElement(te.StackItem,null,n().createElement(ne.Alert,{variant:"warning",isInline:!0,title:n().createElement(K.Text,null,"There ",(0,I._6)(R.length,"was","were")," ",n().createElement(ae.Popover,{"aria-label":"Resolution error popover",bodyContent:n().createElement(s.Fragment,null,R.map(((e,t)=>n().createElement("div",{key:t},e))))},n().createElement("b",null,n().createElement(se.Button,{variant:"link",isInline:!0},R.length)," ",(0,I._6)(R.length,"error")))," ","while fetching resolutions for your issues!"," ")})),n().createElement(K.TextContent,null,n().createElement(K.Text,null,"You selected"," ",n().createElement("b",null,`${o.length} ${(0,I._6)(o.length,"system")}`," "),"to remediate with Ansible, which in total includes"," ",n().createElement("b",null,`${t?.length} ${(0,I._6)(t?.length,"issue")}`," "),t?.length===C.length||x?"which":n().createElement(s.Fragment,null,"of which ",n().createElement("b",null,C.length," "))," ","can be remediated by Ansible."))),n().createElement(te.StackItem,null,n().createElement(Q.Grid,{hasGutter:!0},n().createElement(Q.GridItem,{sm:12,md:6,lg:4},n().createElement(J.Radio,{label:p?`Add to existing playbook (${p.length})`:"Add to existing playbook","aria-label":"Add to existing playbook",id:"existing",name:"radio",isDisabled:!p||!p.length,defaultChecked:g,onChange:()=>{E(!0),r.change(I.yu,!0),l.onChange(v?.name||""),r.change(I.m0,v)}})),n().createElement(Q.GridItem,{sm:12,md:6,lg:4},p&&!k?n().createElement(M,{selectedPlaybook:v,setIsLoadingRemediation:w,setSelectedPlaybook:S,existingPlaybookSelected:g,existingRemediations:p,input:l,formOptions:r}):n().createElement(Z.Z,{size:Z.i.lg,"data-testid":"skeleton-loader"})))),n().createElement(te.StackItem,null,n().createElement(Q.Grid,{hasGutter:!0},n().createElement(Q.GridItem,{sm:12,md:6,lg:4},n().createElement(J.Radio,{label:"Create new playbook","aria-label":"Create new playbook",id:"new",name:"radio",defaultChecked:!g,onChange:()=>{E(!1),r.change(I.yu,!1),l.onChange(f),r.change(I.m0,void 0)}})),n().createElement(Q.GridItem,{sm:12,md:6,lg:4},n().createElement(X.FormGroup,{fieldId:"remediation-name"},n().createElement(ee.TextInput,{type:"text",value:f,onChange:(e,t)=>{(e=>{b(e),g||l.onChange(e);const t=e.trim();(()=>{const e={};i&&i.forEach((t=>{e[t.name]=!0})),e[t]?u(!0):u(!1)})()})(t)},"aria-label":"Name your playbook",autoFocus:!0,validated:d&&!g&&oe.ValidatedOptions.error}),d&&!g&&n().createElement("p",{className:"pf-v5-u-font-size-sm pf-v5-u-danger-color-100"},"A playbook with the same name already exists within your organization. Try a different name.")))))):n().createElement(j,null)};de.propTypes={issues:i().arrayOf(i().shape({description:i().string,id:i().string})).isRequired,systems:i().arrayOf(i().string).isRequired,allSystems:i().arrayOf(i().string).isRequired,remediationsList:i().array};const me=de;var ue=a(73399);const pe=({issues:e,systems:t,allSystems:a,registry:o,...i})=>{let l=(0,h.useDispatch)();const{input:r}=(0,L.Z)(i),c=(0,_.default)(),d=c.getState().errors?.systems,[m,u]=(0,s.useState)(null),p=(0,h.useSelector)((({entities:e})=>(e?.rows||[]).length)),y=(0,h.useSelector)((({entities:e})=>e?.selected||[])),g=(0,h.useSelector)((({entities:e})=>e?.rows?.filter((e=>e.system_profile?.bootc_status?.booted?.image)).map((e=>e.id))||[])),E=(0,h.useSelector)((({entities:e})=>e?.loaded)),f=(0,h.useSelector)((({hostReducer:{hosts:e}})=>e?.map((e=>({id:e.id,name:e.display_name})))||[]));(0,s.useEffect)((()=>{const a=y.some((e=>g.includes(e))),s=e?.some((e=>e?.id?.startsWith("advisor")));if(a&&!s)return u("Image mode systems cannot be added to a remediation playbook."),r.onChange({});u(null);const n=e?.reduce(((e,a)=>{const s=(0,I.Y4)([...t,...a.systems||[]]).filter((e=>y?.includes(e)));return{...e,...s.length>0?{[a.id]:s}:{}}}),{});ce()(r.value,n)||r.onChange(n)}),[y]);const b=e=>{l({type:I.Zp,payload:e})};return n().createElement(te.Stack,{hasGutter:!0,"data-component-ouia-id":"wizard-review-systems","data-testid":"wizard-review-systems"},n().createElement(te.StackItem,null,n().createElement(K.TextContent,null,n().createElement(K.Text,null,"Review and optionally exclude systems from your selection."))),n().createElement(te.StackItem,null,n().createElement(ue.Z,{registry:o,allSystemsNamed:f,allSystems:a,hasCheckbox:!0,bulkSelect:{id:"select-systems",count:y.length,items:[{title:"Select none (0)",onClick:()=>b(!1)},...E&&p>0?[{title:`Select page (${p})`,onClick:()=>b(!0)}]:[]],checked:y.length>0,onSelect:e=>b(e)},onSelectRows:!0})),(m||d)&&E&&n().createElement(te.StackItem,null,n().createElement(V(),{className:"ins-c-remediations-error pf-u-mr-sm"}),n().createElement("span",{className:"ins-c-remediations-error"},m||d)))};pe.propTypes={issues:i().arrayOf(i().shape({description:i().string,id:i().string})).isRequired,systems:i().arrayOf(i().string).isRequired,allSystems:i().arrayOf(i().string).isRequired,registry:i().instanceOf(f.ZP).isRequired};const ye=pe;var he=a(75863),ge=a(7732),Ee=a(5756),fe=a(43416),be=a(49004),ve=a(58027);const Se=e=>{const t=(0,_.default)().getState().values,a=e.issues.filter((e=>Object.keys(t[I.vF]).includes(e.id))),{input:o}=(0,L.Z)(e),[i,l]=(0,s.useState)({index:void 0,direction:void 0}),r=(0,h.useSelector)((({hostReducer:{hosts:e}})=>e?.map((e=>({id:e.id,name:e.display_name})))||[])),c=(t[I.yu]?t[I.ko].filter((e=>!t[I.m0].issues.some((t=>t.id===e.id)))):t[I.ko]).map((e=>({...e,systems:t[I.vF][e.id]}))).filter((e=>e?.systems?.length>0)),[d,m]=(0,s.useState)((0,I.TE)(c,i,!0,r));return(0,s.useEffect)((()=>{m((0,I.TE)(c,i,!0,r))}),[i]),n().createElement(te.Stack,{hasGutter:!0,"data-component-ouia-id":"wizard-review-actions","data-testid":"wizard-review-actions"},n().createElement(te.StackItem,null,n().createElement(K.TextContent,null,n().createElement(K.Text,null,"You have selected"," ",n().createElement("b",null,`${a.length} ${(0,I._6)(a.length,"item")}`)," to remediate."," ",n().createElement("b",null,c.length," of"," ",`${a.length} ${(0,I._6)(a.length,"item")}`),1!==c.length?" allow":" allows"," for you to chose from multiple resolution steps."))),n().createElement(te.StackItem,null,n().createElement(J.Radio,{label:`Review and/or change the resolution steps for ${1!==c.length?"these":"this"}\n                         ${c.length} ${(0,I._6)(c.length,"action")}.`,id:"change",name:"radio",isChecked:o.value,onChange:()=>o.onChange(!0)}),a.length-c.length>0&&n().createElement(K.Text,{className:"rem-c-choose-actions-description"},`The ${a.length-c.length} other selected ${(0,I._6)(a.length-c.length,"issue")} \n                    ${a.length-c.length!=1?"do":"does"} not have multiple resolution options.`)),n().createElement(fe.i,{"aria-label":"Actions",className:"ins-c-remediation-summary-table",variant:he.B.compact,onCollapse:(e,t,a)=>(0,I.ar)(e,t,a,d,m),cells:[{title:"Action",transforms:[ge.p]},{title:"Resolution",transforms:[ge.p]},{title:"Reboot required",transforms:[ge.p]},{title:"Systems",transforms:[ge.p],cellFormatters:[Ee.zW]}],rows:d,onSort:(e,t,a)=>l({index:t,direction:a}),sortBy:i},n().createElement(be.x,{noWrap:!0}),n().createElement(ve.R,null)),n().createElement(te.StackItem,null,n().createElement(J.Radio,{label:"Accept all recommended resolution steps for all actions",id:"accept",name:"radio",isChecked:!o.value,onChange:()=>o.onChange(!1)}),n().createElement(K.Text,{className:"rem-c-choose-actions-description"},"You may modify reboot status to manual reboot in the next step, or from the playbook.")))};Se.propTypes={issues:i().arrayOf(i().shape({description:i().string,id:i().string})).isRequired};const ke=Se;var we=a(45997),Te=a(13193),Re=a(45578),Ce=a.n(Re);const xe=({issue:e})=>{const t=(0,_.default)(),a=t.getState().values[I.Vf],o=t.getState().values[I.vF][e.id]||[],i=a.find((t=>t.id===e.id))?.resolutions||[],l=Ce()(i,"id"),r=le()(i,l,ce());return n().createElement(te.Stack,{hasGutter:!0,"data-component-ouia-id":"wizard-issue-resolution"},n().createElement(te.StackItem,null,n().createElement(Te.Title,{headingLevel:"h2"},`Choose action: ${(0,I.u9)(e.id)}`)),n().createElement(te.StackItem,null,r.length>0&&n().createElement(te.StackItem,{className:"pf-u-mb-sm"},n().createElement(ne.Alert,{variant:"warning",isInline:!0,title:n().createElement(K.Text,null,"There ",(0,I._6)(r.length,"was","were")," ",n().createElement(ae.Popover,{"aria-label":"Resolution duplicates popover",bodyContent:n().createElement(s.Fragment,null,r.map(((e,t)=>n().createElement("div",{key:t},e.description))))},n().createElement("b",null,n().createElement(se.Button,{variant:"link",isInline:!0},r.length)," ",(0,I._6)(r.length,"resolution")))," ","removed due to duplication")})),n().createElement(K.TextContent,null,n().createElement(K.Text,null,"Review the possible resolution steps and select which to add to your playbook."),n().createElement(K.Text,{className:"ins-c-remediations-action-description"},e.action),n().createElement(K.Text,{className:"ins-c-remediations-action-description"},`Resolution affects ${o.length} ${(0,I._6)(o.length,"system")}`))),n().createElement(te.StackItem,null,n().createElement("div",{className:"ins-c-resolution-container"},l.map(((a,s)=>n().createElement("div",{className:"ins-c-resolution-option",key:a.id},n().createElement(we.Tile,{onClick:()=>t.change(I.Tx,{...t.getState().values[I.Tx],[e.id]:a.id}),isSelected:t.getState().values[I.Tx][e.id]?t.getState().values[I.Tx][e.id]===a.id:0===s,title:a.description},n().createElement(K.TextContent,{className:"pf-u-pt-sm"},n().createElement(K.Text,{className:"pf-u-mb-sm ins-c-playbook-description"},'Resolution from "',e.id.split(/:|\|/)[1],'"'),n().createElement("div",{className:"ins-c-reboot-required"},n().createElement(K.Text,{component:"span"},a.needs_reboot?"Reboot required":n().createElement("span",null,"Reboot ",n().createElement("b",null,"not")," required")))))))))))};xe.propTypes={issue:i().shape({id:i().string,action:i().string,alternate:i().number,systems:i().arrayOf(i().string)}).isRequired};const Ie=xe;var Ae=a(29738),Fe=a.n(Ae),Oe=a(70358);const Ne=e=>{const t=(0,_.default)(),a=t.getState().values[I.m0],o=t.getState().values[I.yu],i=t.getState().values[I.vF],{data:l,issuesById:r}={...e,data:{...e.data,issues:e.data.issues.filter((e=>i[e.id]?.length>0))}},{input:c}=(0,L.Z)(e),[d,m]=(0,s.useState)({index:void 0,direction:void 0}),u=(0,h.useSelector)((({hostReducer:{hosts:e}})=>e?.map((e=>({id:e.id,name:e.display_name})))||[])),p=l.issues.map((e=>{const a=(0,I.uG)(e.id,t.getState().values),{description:s,needs_reboot:n}=a?.[0]||{};return{action:r[e.id].description,resolution:s,needsReboot:n,systems:i[e.id]}}));(0,s.useEffect)((()=>{c.onChange(""!==c.value?c.value:o&&a.auto_reboot||p.some((e=>e.needsReboot)))}),[]);const[y,g]=(0,s.useState)((0,I.TE)(p,d,!1,u));return(0,s.useEffect)((()=>{g((0,I.TE)(p,d,!1,u))}),[d]),n().createElement(te.Stack,{hasGutter:!0,"data-component-ouia-id":"wizard-review","data-testid":"wizard-review"},n().createElement(te.StackItem,null,n().createElement(K.TextContent,null,n().createElement(K.Text,null,"Issues listed below will be added to the playbook"," ",n().createElement("b",null,t.getState().values[I.mT]),"."))),p.some((e=>e.needsReboot))&&n().createElement(te.StackItem,null,n().createElement(K.TextContent,null,n().createElement(K.Text,{className:"ins-c-playbook-reboot-required"},n().createElement(Fe(),null)," A system reboot is required to remediate selected issues"))),n().createElement(te.StackItem,null,n().createElement(K.TextContent,null,n().createElement(K.Text,null,"The playbook ",n().createElement("b",null,t.getState().values[I.mT]),c.value?" does":n().createElement("span",{className:"ins-c-remediation-danger-text"}," does not")," ","auto reboot systems."))),n().createElement(te.StackItem,null,n().createElement(Oe.Switch,{"data-testid":"autoreboot-switch",label:"Turn off autoreboot",labelOff:"Turn on autoreboot",isChecked:c.value,onChange:()=>c.onChange(!c.value)})),n().createElement(fe.i,{"aria-label":"Actions",className:"ins-c-remediation-summary-table",variant:he.B.compact,cells:[{title:"Action",transforms:[ge.p]},{title:"Resolution",transforms:[ge.p]},{title:"Reboot required",transforms:[ge.p]},{title:"Systems",transforms:[ge.p],cellFormatters:[Ee.zW]}],rows:y,onSort:(e,t,a)=>m({index:t,direction:a}),onCollapse:(e,t,a)=>(0,I.ar)(e,t,a,y,g),sortBy:d},n().createElement(be.x,{noWrap:!0}),n().createElement(ve.R,null)))};Ne.propTypes={data:i().shape({issues:i().array,systems:i().array,onRemediationCreated:i().func}).isRequired,issuesById:i().shape({[i().string]:i().shape({id:i().string,description:i().string})}).isRequired};const Pe=Ne,Be={isLoading:!1,resolutions:void 0},$e={[`${d.JY}_FULFILLED`]:(e,{payload:t})=>({...e,...t,isLoading:!1}),[`${d.JY}_PENDING`]:e=>({...e,isLoading:!0})};var Le=a(48273);const _e=({percent:e,failed:t})=>{let a,s;return 100===e?(s="Completed",a=Le.ProgressVariant.success):t?(s="Error",a=Le.ProgressVariant.danger):(s="In progress",a=Le.ProgressVariant.info),n().createElement(Le.Progress,{"data-testid":"finished-create-remediation",value:e,title:s,variant:a})};_e.propTypes={percent:i().number,failed:i().bool};const Ze=_e;var qe=a(44278),ze=a.n(qe),Ve=a(40773),De=a.n(Ve),Ge=a(37248),je=a.n(Ge);const We=({onClose:e,setOpen:t,submitRemediation:a,setState:s,state:o})=>{const{percent:i,failed:l,systems:r,issues:c,playbook:d}={percent:o.percent,failed:o.failed,systems:(0,I.Y4)(Object.values(o.formValues[I.vF]).flat()),issues:Object.keys(o.formValues[I.vF]),playbook:{name:o.formValues[I.mT],id:o.id}};return n().createElement(q.EmptyState,{variant:q.EmptyStateVariant.lg,"data-testid":"wizard-progress","data-component-ouia-id":"wizard-progress"},n().createElement(q.EmptyStateHeader,{titleText:n().createElement(n().Fragment,null,l?"Error: Unable to add items to playbook":100===i?"Items added to playbook":"Adding items to the playbook"),icon:n().createElement(q.EmptyStateIcon,{className:"pf-u-mb-lg pf-u-mt-sm",color:l?"var(--pf-global--danger-color--100)":100===i?"var(--pf-global--success-color--100)":void 0,icon:l?V():100===i?ze():je()}),headingLevel:"h1"}),n().createElement(q.EmptyStateBody,{className:"pf-c-progress-bar pf-u-mt-md"},n().createElement(Ze,{percent:i,failed:l})),n().createElement(q.EmptyStateFooter,null,(l||100===i)&&n().createElement(q.EmptyStateBody,{className:"pf-c-progress-message"},l?"Please try again.":n().createElement("div",null,`${c.length} ${(0,I._6)(c.length,"action")} affecting \n                        ${r.length} ${(0,I._6)(r.length,"system")} \n                        ${c.length>1?"were":"was"} added to the playbook `,n().createElement("a",{href:(0,I.B3)(d.id)},d.name),".")),100===i&&n().createElement(q.EmptyStateBody,{className:"pf-c-progress-message-description pf-u-mb-md"},"You can remediate these systems directly from Insights by enabling",n().createElement(se.Button,{className:"pf-u-py-0 pf-u-px-xs",variant:"link",ouiaId:"CloudConnectorButton",icon:n().createElement(De(),null),iconPosition:"right",size:"sm",onClick:()=>window.location.href=`${window.location.origin}/${(0,I.QU)()}settings/connector`},"Cloud Connector"),"on eligible systems."),l&&n().createElement(se.Button,{className:"pf-u-mt-md pf-u-mb-sm",variant:"primary",ouiaId:"TryAgainButton","data-testid":"TryAgainButton",onClick:()=>{s({failed:!1,percent:0}),a(!1)}},"Try again"),100===i&&n().createElement(se.Button,{className:"pf-u-mt-md pf-u-mb-sm",variant:"primary",ouiaId:"ReturnToAppButton",onClick:()=>{e(),t(!1)}},"Return to application"),n().createElement(q.EmptyStateActions,null,l&&n().createElement(se.Button,{variant:"secondary",ouiaId:"BackToWizardButton","data-testid":"BackToWizardButton",onClick:()=>{e()}},"Go back to the wizard"),100===i&&n().createElement(se.Button,{variant:"link",component:"a",ouiaId:"OpenPlaybookButton","data-testid":"OpenPlaybookButton",href:(0,I.B3)(d.id),onClick:()=>{e(),t(!1)}},"Open playbook ",d.name))))};We.propTypes={onClose:i().func,setOpen:i().func,submitRemediation:i().func,setState:i().func,state:i().shape({id:i().string,percent:i().number.isRequired,failed:i().bool.isRequired,formValues:i().shape({[I.mT]:i().string,[I.vF]:i().objectOf(i().arrayOf(i().string))})})};const Ye=We;var He=a(79790);const Ue={submitted:!1,id:void 0,percent:0,failed:!1,formValues:void 0},Me=(e,t)=>{switch(t.type){case"schema":return{...e,schema:t.payload};case"state":return{...e,...t.payload};default:throw new Error}},Xe=({setOpen:e,data:t,basePath:a,registry:o})=>{const i=(0,s.useRef)((0,I.Y4)(t.issues?.reduce(((e,t)=>[...e,...t.systems||[]]),[...t.systems||[]]))),l=(0,He.Q)(),r=(0,h.useDispatch)(),[m,u]=(0,s.useReducer)(Me,Ue),p=w()(t.issues,(e=>e.id));(0,s.useEffect)((()=>{l&&u({type:"schema",payload:O(t.issues,l)}),o.register({hostReducer:(0,S.applyReducerHash)(v,b),resolutionsReducer:(0,S.applyReducerHash)($e,Be)}),r(((e=[])=>({type:d.JY,payload:y(e)}))(t.issues)),((e=[])=>{(0,I.C1)(e,50).forEach((e=>{r(((e,t={})=>({type:d.mg,payload:c(e,t)}))(e,{page:1,perPage:50}))}))})(i.current)}),[l]);const g={"select-playbook":{component:me,issues:t.issues,systems:t.systems,allSystems:i.current,remediationsList:l},"review-systems":{component:ye,issues:t.issues,systems:t.systems||[],allSystems:i.current,registry:o},"review-actions":{component:ke,issues:t.issues},"issue-resolution":{component:Ie},review:{component:Pe,data:t,issuesById:p}},E={"validate-systems":()=>e=>e&&Object.values(e).filter((e=>void 0!==e)).length?void 0:"At least one system must be selected. Actions must be associated to a system to be added to a playbook."};return n().createElement(s.Fragment,null,m.schema&&!m.submitted?n().createElement(T.Z,{schema:m.schema,subscription:{values:!0},FormTemplate:e=>n().createElement(R.ZP,{...e,showFormControls:!1}),initialValues:{[I.Vf]:[],[I.ko]:[],[I.vF]:{},[I.BA]:!0,[I.Tx]:{},[I.yu]:!1},componentMapper:{[C.Z.WIZARD]:{component:N.Z,className:"remediations","data-ouia-component-id":"remediation-wizard"},[C.Z.TEXT_FIELD]:$.Z,...g},validatorMapper:E,onSubmit:e=>{u({type:"state",payload:{submitted:!0,formValues:e}}),(0,I.ec)(e,t,a,(e=>u({type:"state",payload:e})))},onCancel:()=>e(!1)}):null,m.submitted?n().createElement(P.Modal,{isOpen:!0,variant:P.ModalVariant.large,showClose:!1,className:"remediations",hasNoBodyWrapper:!0,"aria-describedby":"wiz-modal-description","aria-labelledby":"wiz-modal-title"},n().createElement(B.e,{className:"remediations",title:"Remediate with Ansible",description:"Add actions to an Ansible Playbook",steps:[{name:"progress",component:n().createElement(Ye,{onClose:()=>{u({type:"state",payload:{submitted:!1,id:void 0,failed:!1,formValues:void 0}})},title:"Adding items to the playbook",setOpen:e,submitRemediation:()=>(0,I.ec)(m.formValues,t,a,(e=>u({type:"state",payload:e}))),setState:e=>u({type:"state",payload:e}),state:m}),isFinishedStep:!0}],onClose:()=>{u({type:"state",payload:{submitted:!1,id:void 0,failed:!1,formValues:void 0}}),e(!1)}})):null)};Xe.propTypes={setOpen:i().func.isRequired,data:i().shape({issues:i().arrayOf(i().shape({description:i().string,id:i().string})),systems:i().arrayOf(i().string),onRemediationCreated:i().func}).isRequired,basePath:i().string,registry:i().shape({register:i().func}).isRequired,remediationsList:i().array};const Qe=e=>{const[t,a]=(0,s.useState)();return(0,s.useEffect)((()=>{a((()=>new f.ZP({},[E()])))}),[]),t?.store?n().createElement(h.Provider,{store:t.store},n().createElement(Xe,{...e,registry:t})):null}},65088:()=>{}}]);
//# sourceMappingURL=../sourcemaps/1891.2930f06466d83760f36215044f591e66.js.map